<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartClaim Pro | Upload & Analyze</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg-deep: #080a0f;
  --accent-blue: #38bdf8;
  --accent-green: #22c55e;
  --accent-yellow: #facc15;
  --accent-red: #ef4444;
  --glass: rgba(255, 255, 255, 0.02);
  --border: rgba(255, 255, 255, 0.08);
}
body {
  font-family: 'Plus Jakarta Sans', sans-serif;
  background-color: var(--bg-deep);
  color: white;
  min-height:100vh;
  overflow-x:hidden;
}
.mesh-bg {
  position: fixed;
  inset:0;
  z-index:-1;
  background:
    radial-gradient(circle at 20% 20%, rgba(56,189,248,0.15), transparent 40%),
    radial-gradient(circle at 80% 30%, rgba(129,140,248,0.1), transparent 50%),
    radial-gradient(circle at 50% 80%, rgba(56,189,248,0.05), transparent 60%);
  filter: blur(80px);
}
nav {
  background: rgba(255,255,255,0.03);
  backdrop-filter: blur(12px);
  border-bottom:1px solid rgba(255,255,255,0.05);
}
.glass-panel {
  background: var(--glass);
  backdrop-filter: blur(40px) saturate(180%);
  border: 1px solid var(--border);
  box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
  border-radius:24px;
  padding:2rem;
}
.step-pill {
  padding:0.5rem 1.5rem;
  border-radius:9999px;
  font-size:0.75rem;
  font-weight:800;
  background: rgba(255,255,255,0.05);
  color:#6b7280;
}
.step-pill.active {
  background: var(--accent-blue);
  color:white;
  box-shadow:0 0 20px var(--accent-blue);
}
.scanner-slot {
  position:relative;
  background: rgba(0,0,0,0.25);
  border:2px dashed rgba(255,255,255,0.05);
  border-radius:32px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:0.8rem;
  padding:1.5rem;
}
.laser-line {
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:3px;
  background: var(--accent-blue);
  box-shadow:0 0 20px var(--accent-blue);
  display:none;
}
.scanner-slot.scanning .laser-line {
  display:block;
  animation: scan 2s linear infinite;
}
@keyframes scan {
  from { top:0 }
  to { top:100% }
}
.upload-label {
  cursor:pointer;
  background: var(--accent-blue);
  color:white;
  padding:0.6rem 1.2rem;
  border-radius:12px;
  font-weight:800;
  font-size:10px;
}
input {
  background: rgba(0,0,0,0.5);
  border:1px solid var(--border);
  color:white;
}
.button {
  background:#151921;
  padding:1rem;
  border-radius:999px;
  font-weight:800;
  box-shadow:0 10px 20px -10px var(--accent-blue);
  transition: all 0.3s ease;
}
.button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow:0 15px 30px -10px var(--accent-blue);
}
.log-box {
  font-family:'JetBrains Mono', monospace;
  font-size:0.7rem;
  background: rgba(0,0,0,0.4);
  padding:1rem;
  border-radius:16px;
  height:220px;
  overflow-y:auto;
}
</style>
</head>

<body>

<div class="mesh-bg"></div>

<div id="docSourceModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="glass-panel max-w-md w-full text-center space-y-6">
    <h2 class="text-2xl font-extrabold">Choose Document Source</h2>
    <p class="text-sm text-gray-400">
      Upload documents manually or fetch them securely from your locker
    </p>
    <div class="flex gap-4 justify-center">
      <button onclick="chooseUpload()" class="px-6 py-3 rounded-xl bg-sky-500 font-extrabold text-black">
        Upload Now
      </button>
      <button onclick="chooseLocker()" class="px-6 py-3 rounded-xl bg-emerald-500 font-extrabold text-black">
        Use Locker
      </button>
    </div>
  </div>
</div>

<nav class="sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-8 py-4 flex justify-between">
    <div class="text-2xl font-black">SmartClaim<span class="text-sky-400">.Pro</span></div>
    <div class="flex gap-6 text-sm font-bold text-gray-300">
      <a href="index.html">Home</a>
      <a href="submit-claim.html">File Claim</a>
      <a href="history.html">History</a>
    </div>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-8 mt-12 pb-20">

<div class="flex justify-between max-w-2xl mx-auto mb-12">
  <div class="step-pill">1. Incident</div>
  <div class="step-pill active">2. Upload</div>
  <div class="step-pill">3. Track</div>
  <div class="step-pill">4. Review</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">

  <div id="slot-rc" class="scanner-slot glass-panel">
    <div class="laser-line"></div>
    <h4>RC Card</h4>
    <input type="file" id="file-rc" hidden onchange="startScan('rc',this)">
    <label for="file-rc" class="upload-label">Upload RC</label>
  </div>

  <div id="slot-policy" class="scanner-slot glass-panel">
    <div class="laser-line"></div>
    <h4>Policy</h4>
    <input type="file" id="file-policy" hidden onchange="startScan('policy',this)">
    <label for="file-policy" class="upload-label">Upload Policy</label>
  </div>

  <div id="slot-dl" class="scanner-slot glass-panel">
    <div class="laser-line"></div>
    <h4>Driver License</h4>
    <input type="file" id="file-dl" hidden onchange="startScan('dl',this)">
    <label for="file-dl" class="upload-label">Upload DL</label>
  </div>

  <div id="slot-extra" class="scanner-slot glass-panel">
    <div class="laser-line"></div>
    <h4>Extra Documents</h4>
    <input type="file" id="file-extra" hidden multiple onchange="startScan('extra',this)">
    <label for="file-extra" class="upload-label bg-purple-500">Upload FIR/Bills</label>
  </div>

</div>

<div class="glass-panel mt-12">
  <label class="text-xs font-bold">Expected Amount (â‚¹)</label>
  <input id="expectedCost" type="number" class="w-full mt-2 p-3 rounded-xl" placeholder="Enter claim amount">
  <button onclick="startNeuralAnalysis()" id="analyseBtn" class="button w-full mt-4">
    Run AI Analysis
  </button>
  <div id="logs" class="log-box mt-4">[SYSTEM] Waiting for input...</div>
</div>

</main>

<script>
const API_KEY = 'AIzaSyBkgxPWoa870LvoL80KjDEbJjKWamtKB4Q';

function chooseUpload(){
  document.getElementById('docSourceModal').style.display='none';
}

function chooseLocker(){
  document.getElementById('docSourceModal').style.display='none';
  const docs=['rc','policy','dl'];
  const logs=document.getElementById('logs');

  docs.forEach((doc,i)=>{
    setTimeout(()=>{
      const slot=document.getElementById(`slot-${doc}`);
      const label=slot.querySelector('.upload-label');
      slot.classList.add('scanning');
      label.innerHTML='Fetching...';

      setTimeout(()=>{
        slot.classList.remove('scanning');
        label.innerHTML='âœ“ Retrieved';
        label.style.background='#22c55e';
        logs.innerHTML=`[LOCKER] ${doc.toUpperCase()} auto-linked<br>`+logs.innerHTML;
        localStorage.setItem(`has${doc.toUpperCase()}`, 'true');
      },1500);
    },i*800);
  });
}

async function startScan(type, input){
  const file = input.files[0];
  if (!file) return;

  const slot=document.getElementById(`slot-${type}`);
  const label=input.nextElementSibling;
  const logs=document.getElementById('logs');
  
  slot.classList.add('scanning');
  label.innerHTML='Processing...';

  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64Image = reader.result.split(',')[1];

    try {
      const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          requests: [{
            image: { content: base64Image },
            features: [{ type: 'TEXT_DETECTION' }]
          }]
        })
      });

      const data = await response.json();
      const detectedText = data.responses[0]?.fullTextAnnotation?.text || "";
      const userReg = localStorage.getItem('registrationNumber') || "MH-12-AB-1234";

      slot.classList.remove('scanning');
      
      if (type === 'rc' && detectedText.length > 0 && !detectedText.includes(userReg)) {
        label.innerHTML = 'âœ˜ Mismatch';
        label.style.background = '#ef4444';
        logs.innerHTML = `<span style="color:#ef4444">[OCR] Mismatch! Card doesn't match ${userReg}</span><br>` + logs.innerHTML;
        localStorage.setItem('docsStatus', 'missing');
      } else {
        label.innerHTML = 'âœ“ Verified';
        label.style.background = '#22c55e';
        logs.innerHTML = `[OCR] ${type.toUpperCase()} verified by Google AI<br>` + logs.innerHTML;
        localStorage.setItem(`has${type.toUpperCase()}`, 'true');
        localStorage.setItem('docsStatus', 'active');
      }
    } catch (error) {
      console.error(error);
      slot.classList.remove('scanning');
      label.innerHTML = 'âœ“ Verified';
    }
  };
  reader.readAsDataURL(file);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§  NEW TRIAGE LOGIC: COMPARISON SCAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startNeuralAnalysis(){
  const userCost = parseInt(document.getElementById('expectedCost').value);
  const btn = document.getElementById('analyseBtn');
  if(!userCost){ alert('Enter amount'); return; }
  
  const logs = document.getElementById('logs');
  btn.disabled = true;
  btn.innerHTML = "Thinking...";
  
  // Save user input for the next page
  localStorage.setItem('claimedAmount', userCost);
  
  // SIMULATED AI DETECTION (Case Benchmark: â‚¹15,000)
  const aiDetectedCost = 15000; 
  localStorage.setItem('aiDetectedAmount', aiDetectedCost);
  
  logs.innerHTML = '[AI] INITIALIZING DAMAGE SCAN...<br>' + logs.innerHTML;

  setTimeout(() => {
    let score = 0;
    const diff = (userCost - aiDetectedCost) / aiDetectedCost;

    // CASE 4: USER LOWER (Bonus) 
    if (userCost <= aiDetectedCost) {
      score = 10; 
    } 
    // CASE 1: CLOSE MATCH (Within 15%)
    else if (diff <= 0.15) {
      score = 25; 
    } 
    // CASE 2: USER HIGHER (15% to 100% higher)
    else if (diff <= 1.0) {
      score = 55; 
    } 
    // CASE 3: USER MUCH HIGHER (2x+ Block)
    else {
      score = 85; 
    }

    localStorage.setItem('fraudScore', score);
    logs.innerHTML = `[AI] SCAN COMPLETE. BENCHMARK: â‚¹${aiDetectedCost}<br>` + logs.innerHTML;
    logs.innerHTML = `[AI] DEVIANCE DETECTED: ${(diff*100).toFixed(1)}%<br>` + logs.innerHTML;

    setTimeout(() => {
      window.location.href = 'track-claim.html';
    }, 1500);
  }, 2000);
}
</script>

</body>
</html>