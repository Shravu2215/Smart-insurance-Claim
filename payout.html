<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disbursement Setup | SmartClaim Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Google Pay API -->
    <script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
    
    <!-- Razorpay SDK -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <style>
        :root {
            --bg-deep: #080a0f;
            --accent-blue: #38bdf8;
            --glass-white: rgba(255, 255, 255, 0.03);
            --border-white: rgba(255, 255, 255, 0.08);
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .nav-container { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }

        .dynamic-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1;
            background: radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.15) 0%, transparent 50%), radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            filter: blur(80px);
        }

        .glass-card { background: var(--glass-white); backdrop-filter: blur(40px) saturate(180%); border: 1px solid var(--border-white); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }

        .method-tile { cursor: pointer; border: 1px solid var(--border-white); background: rgba(255, 255, 255, 0.01); transition: all 0.3s ease; height: 100%; }
        .method-tile.active { border-color: var(--accent-blue); background: rgba(56, 189, 248, 0.08); box-shadow: 0 0 20px rgba(56, 189, 248, 0.25); }

        .smart-input { background: rgba(0, 0, 0, 0.3) !important; border: 1px solid rgba(255, 255, 255, 0.1) !important; color: white !important; }
        .smart-input:focus { border-color: var(--accent-blue) !important; outline: none; }

        .hidden-panel { display: none; }
        
        .map-box { border: 1px solid rgba(56, 189, 248, 0.3); background: rgba(0,0,0,0.5); border-radius: 20px; overflow: hidden; position: relative; }
        .map-dot { width: 12px; height: 12px; background: #38bdf8; border-radius: 50%; position: absolute; box-shadow: 0 0 15px #38bdf8; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
    </style>
</head>
<body class="pb-20">

    <div class="dynamic-bg"></div>

    <nav class="nav-container sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-8 py-4 flex justify-between items-center h-16">
            <div class="text-xl font-black italic uppercase tracking-tighter text-white">SmartClaim<span class="text-sky-400">.Pro</span></div>
            <div class="flex items-center space-x-10 text-gray-300 text-sm font-bold">
                <a href="index.html" class="hover:text-white transition">Home</a>
                <a href="submit-claim.html" class="text-white">File Claim</a>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-8 grid grid-cols-1 lg:grid-cols-12 gap-12 mt-16">
        <div class="lg:col-span-8 space-y-10">
            <div>
                <h2 class="text-4xl font-black italic uppercase mb-2 tracking-tighter text-white">Settlement <span class="text-sky-400">Method</span></h2>
                <p class="text-gray-400 text-base font-medium opacity-80">Choose your preferred disbursement protocol.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div id="btn-cashless" class="method-tile active p-8 rounded-[32px] flex flex-col items-center gap-4 text-center" onclick="switchMethod('cashless')">
                    <span class="text-4xl">üõ†Ô∏è</span>
                    <div>
                        <h4 class="text-xs font-black uppercase tracking-widest text-white mb-1">Cashless Payment</h4>
                        <p class="text-[9px] text-gray-500 uppercase font-bold">Direct to Garage Settlement</p>
                    </div>
                </div>
                
                <div id="btn-upi" class="method-tile p-8 rounded-[32px] flex flex-col items-center gap-4 text-center" onclick="switchMethod('upi')">
                    <span class="text-4xl">‚ö°</span>
                    <div>
                        <h4 class="text-xs font-black uppercase tracking-widest text-white mb-1">UPI Payment</h4>
                        <p class="text-[9px] text-gray-500 uppercase font-bold">Direct to User Account</p>
                    </div>
                </div>
            </div>

            <div class="glass-card p-10 rounded-[40px]">
                <div id="panel-cashless" class="space-y-8">
                    <div class="bg-sky-500/10 border border-sky-500/20 p-6 rounded-2xl">
                        <h4 class="text-sky-400 font-black text-xs uppercase tracking-widest mb-2">Cashless Protocol Active</h4>
                        <p class="text-[11px] text-gray-400 leading-relaxed">System has authorized a direct payment to the service center. You do not need to pay anything from your pocket.</p>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest">Recommended Authorized Center</label>
                        <div class="flex items-center justify-between bg-white/5 p-5 rounded-2xl border border-white/10">
                            <div>
                                <p class="text-base font-extrabold text-white">Elite Auto Care - Authorised Center</p>
                                <p class="text-[11px] text-gray-400 italic">2.4 km from your spot ‚Ä¢ MG Road Sector 4</p>
                            </div>
                            <button onclick="window.open('https://www.google.com/maps')" class="bg-sky-500/20 text-sky-400 px-5 py-2 rounded-xl text-[10px] font-black uppercase border border-sky-400/30 hover:bg-sky-500 transition-all hover:text-black">Google Maps</button>
                        </div>
                    </div>

                    <div class="map-box h-56 w-full relative">
                        <div class="absolute inset-0 bg-slate-900 flex items-center justify-center">
                            <span class="text-[10px] text-white/20 font-black uppercase tracking-[0.4em]">Neural Map Interface</span>
                        </div>
                        <div class="map-dot top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                    </div>
                </div>

                <div id="panel-upi" class="hidden-panel space-y-8">
                    <div class="bg-yellow-500/10 border border-yellow-500/20 p-6 rounded-2xl">
                        <h4 class="text-yellow-500 font-black text-xs uppercase tracking-widest mb-2">Standard Disbursement Window</h4>
                        <p class="text-[11px] text-gray-400 leading-relaxed">UPI payouts are verified via the national ledger and settled into your account <strong>within 24 hours (1 Business Day)</strong>.</p>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest">Enter Your UPI ID</label>
                        <input id="upiInput" type="text" placeholder="username@bank" class="smart-input w-full rounded-2xl p-6 text-2xl font-black tracking-tight">
                        <p class="text-[9px] text-gray-500 italic uppercase font-bold tracking-widest">Verified identity must match the policy holder name.</p>
                    </div>

                    <div class="space-y-4">
                        <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest">Claim Amount</label>
                        <input id="claimAmount" type="number" placeholder="‚Çπ 0.00" value="Enter amount" class="smart-input w-full rounded-2xl p-6 text-2xl font-black tracking-tight">
                    </div>

                    <div class="mt-6">
                        <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest mb-4">Pay Using</label>
                        <button onclick="onGooglePaymentButtonClicked()" class="w-full bg-white hover:bg-gray-100 text-black font-bold py-5 rounded-2xl flex items-center justify-center gap-3 transition-all shadow-lg mb-4">
                            <svg width="41" height="17" viewBox="0 0 41 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19.526 9.695h-1.628V4.77h2.747c.768 0 1.403.256 1.903.767.5.512.75 1.162.75 1.951 0 .81-.254 1.47-.76 1.982-.507.51-1.136.766-1.887.766h-1.125v-.542zm0-4.382v3.84h1.154c.522 0 .953-.178 1.293-.534.34-.356.51-.817.51-1.382 0-.545-.168-.995-.505-1.35-.337-.356-.766-.534-1.288-.534h-1.164v-.04zm5.748 4.382l-.03-1.095c-.146.366-.408.66-.786.883a2.24 2.24 0 0 1-1.193.334c-.612 0-1.13-.214-1.556-.642-.425-.428-.638-.96-.638-1.596 0-.687.235-1.234.704-1.642.47-.408 1.109-.612 1.918-.612h1.551v-.301c0-.377-.123-.683-.37-.917-.246-.235-.574-.352-.983-.352-.654 0-1.196.27-1.628.812l-.827-.679c.593-.752 1.397-1.128 2.414-1.128.726 0 1.327.207 1.802.622.475.415.713.965.713 1.652v3.661h-1.09zm-1.648-.863c.501 0 .923-.173 1.266-.52.343-.345.515-.774.515-1.285v-.444h-1.48c-.931 0-1.397.352-1.397 1.056 0 .316.113.577.34.783.226.206.514.31.863.31h-.107zm4.772-5.702l2.07 5.21 2.019-5.21h1.206l-3.164 7.728h-1.134l.984-2.318-2.196-5.41h1.215z" fill="#5F6368"/>
                                <path d="M13.324 7.174c0-.454-.038-.892-.113-1.314H6.822v2.487h3.644a3.117 3.117 0 0 1-1.35 2.044v1.614h2.185c1.279-1.177 2.017-2.91 2.017-4.831h.006z" fill="#4285F4"/>
                                <path d="M6.822 13.872c1.826 0 3.358-.604 4.477-1.637l-2.185-1.695c-.605.405-1.38.644-2.292.644-1.762 0-3.254-1.19-3.786-2.788H.815v1.754a6.999 6.999 0 0 0 6.007 3.722z" fill="#34A853"/>
                                <path d="M3.036 8.396a4.205 4.205 0 0 1 0-2.692V4.05H.815a6.997 6.997 0 0 0 0 6.287l2.221-1.754v.813z" fill="#FBBC04"/>
                                <path d="M6.822 3.178c.994 0 1.886.341 2.588 1.012l1.94-1.94C10.174 1.145 8.648.5 6.822.5A6.999 6.999 0 0 0 .815 4.222L3.036 5.97c.532-1.599 2.024-2.793 3.786-2.793z" fill="#EA4335"/>
                            </svg>
                            <span class="text-base">Pay with Google Pay</span>
                        </button>

                        <button onclick="payWithRazorpay()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl flex items-center justify-center gap-3 transition-all shadow-lg">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14.7 12.3l-2.7 2.7-9-9L5.7.3l9 9 3 3z" fill="currentColor"/>
                                <path d="M18 6L6 18l3 3 12-12-3-3z" fill="currentColor"/>
                            </svg>
                            <span class="text-base">Pay with Razorpay</span>
                        </button>
                    </div>
                </div>


            </div>

            <button id="finalizeBtn" onclick="processFinalPayout()" class="w-full bg-sky-500 hover:bg-sky-400 text-black font-black py-6 rounded-[32px] uppercase tracking-[0.4em] flex items-center justify-center gap-4 shadow-xl shadow-sky-500/20 transition-all text-xs">
                <span id="btnText">Confirm Settlement</span>
                <div id="btnLoader" class="hidden w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"></div>
            </button>
        </div>

        <div class="lg:col-span-4 space-y-8">
            <div class="glass-card p-8 rounded-[40px] border-white/5">
                <div class="flex items-center gap-4 mb-8">
                    <div class="w-12 h-12 bg-sky-500/20 rounded-2xl flex items-center justify-center border border-sky-400/30 text-2xl animate-pulse">ü§ñ</div>
                    <div>
                        <h4 class="font-black text-[10px] text-white uppercase tracking-widest">Neural Agent</h4>
                        <span class="text-[8px] font-black text-green-500 uppercase tracking-tighter">Analyzing Channels</span>
                    </div>
                </div>
                <div id="logs" class="font-mono text-[9px] text-sky-400/70 space-y-2 bg-black/40 p-4 rounded-xl h-48 overflow-y-auto border border-white/5">
                    <div>> System initialized.</div>
                    <div>> Preferred path: Cashless Garage Settlement.</div>
                </div>
            </div>
            <p class="text-[9px] text-gray-600 font-bold uppercase text-center tracking-tighter italic">
                Save your money‚Äîdon't spend on stupid high repair estimates. SmartClaim ensures fair pricing for everyone!
            </p>
        </div>
    </main>

    <script>
        let paymentsClient;
        let currentMethod = 'cashless';

        function onGooglePayLoaded() {
            const baseRequest = {
                apiVersion: 2,
                apiVersionMinor: 0
            };

            paymentsClient = new google.payments.api.PaymentsClient({
                environment: 'TEST' // Change to 'PRODUCTION' for live
            });

            const tokenizationSpecification = {
                type: 'PAYMENT_GATEWAY',
                parameters: {
                    'gateway': 'example',
                    'gatewayMerchantId': 'exampleGatewayMerchantId'
                }
            };

            const cardPaymentMethod = {
                type: 'CARD',
                parameters: {
                    allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
                    allowedCardNetworks: ['MASTERCARD', 'VISA']
                },
                tokenizationSpecification: tokenizationSpecification
            };

            const upiPaymentMethod = {
                type: 'UPI',
                parameters: {
                    payeeVpa: 'merchant@upi',
                    payeeName: 'SmartClaim Pro',
                    referenceUrl: 'https://smartclaim.pro',
                    transactionReferenceId: 'TXN' + Date.now()
                }
            };

            const isReadyToPayRequest = Object.assign({}, baseRequest, {
                allowedPaymentMethods: [cardPaymentMethod, upiPaymentMethod]
            });

            paymentsClient.isReadyToPay(isReadyToPayRequest)
                .then(response => {
                    if (response.result) {
                        addGooglePayButton();
                    }
                })
                .catch(err => {
                    console.error('Google Pay error:', err);
                });
        }

        function addGooglePayButton() {
            const button = paymentsClient.createButton({
                onClick: onGooglePaymentButtonClicked,
                buttonColor: 'white',
                buttonType: 'pay',
                buttonSizeMode: 'fill'
            });
            document.getElementById('googlePayButtonContainer').appendChild(button);
        }

        function onGooglePaymentButtonClicked() {
            const amount = document.getElementById('claimAmount').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid claim amount');
                return;
            }

            // Log the action
            const logs = document.getElementById('logs');
            logs.prepend(Object.assign(document.createElement('div'), {
                className: 'text-yellow-400 font-bold',
                innerHTML: `> Redirecting to Google Pay...`
            }));

            // Simulate payment completion
            setTimeout(() => {
                logs.prepend(Object.assign(document.createElement('div'), {
                    className: 'text-green-400 font-bold',
                    innerHTML: `> Payment Received via Google Pay ‚úì`
                }));
                
                // Show success message
                setTimeout(() => {
                    alert('Payment Received via Google Pay!\n\nAmount: ‚Çπ' + amount + '\nRedirecting to receipt...');
                    window.location.href = 'receipt.html';
                }, 1500);
            }, 3000);
        }

        function payWithRazorpay() {
            const amount = document.getElementById('claimAmount').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid claim amount');
                return;
            }

            const logs = document.getElementById('logs');
            logs.prepend(Object.assign(document.createElement('div'), {
                className: 'text-yellow-400 font-bold',
                innerHTML: `> Initializing Razorpay payment...`
            }));

            var options = {
                "key": "rzp_test_1DP5mmOlF5G5ag",
                "amount": amount * 100,
                "currency": "INR",
                "name": "SmartClaim Pro",
                "description": "Insurance Claim Settlement",
                "handler": function (response){
                    logs.prepend(Object.assign(document.createElement('div'), {
                        className: 'text-green-400 font-bold',
                        innerHTML: `> Payment Received via Razorpay ‚úì`
                    }));
                    
                    setTimeout(() => {
                        alert('Payment Received via Razorpay!\n\nPayment ID: ' + response.razorpay_payment_id + '\nAmount: ‚Çπ' + amount + '\n\nRedirecting to receipt...');
                        window.location.href = 'receipt.html';
                    }, 1000);
                },
                "prefill": {
                    "name": "Customer Name",
                    "email": "customer@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "claim_type": "Insurance Settlement"
                },
                "theme": {
                    "color": "#38bdf8"
                },
                "method": {
                    "upi": true
                }
            };
            
            var rzp1 = new Razorpay(options);
            
            rzp1.on('payment.failed', function (response){
                logs.prepend(Object.assign(document.createElement('div'), {
                    className: 'text-red-400 font-bold',
                    innerHTML: `> Payment failed: ${response.error.description}`
                }));
                alert('Payment Failed!\n\n' + response.error.description);
            });
            
            rzp1.open();
        }

        function processPayment(paymentData) {
            const logs = document.getElementById('logs');
            logs.prepend(Object.assign(document.createElement('div'), {
                className: 'text-green-400 font-bold',
                innerHTML: `> Google Pay transaction initiated...`
            }));

            setTimeout(() => {
                logs.prepend(Object.assign(document.createElement('div'), {
                    className: 'text-green-400 font-bold',
                    innerHTML: `> Payment successful! UPI transfer completed.`
                }));

                setTimeout(() => {
                    window.location.href = 'receipt.html';
                }, 1500);
            }, 2000);
        }

        function switchMethod(method) {
            currentMethod = method;
            document.querySelectorAll('.method-tile').forEach(t => t.classList.remove('active'));
            document.getElementById('btn-' + method).classList.add('active');
            
            ['upi', 'cashless'].forEach(m => {
                const panel = document.getElementById('panel-' + m);
                if(panel) panel.style.display = (m === method) ? 'block' : 'none';
            });

            const logMsg = method === 'cashless' ? '> Switched to Direct Garage Protocol.' : '> Switched to 1-Day Payout Protocol.';
            document.getElementById('logs').prepend(Object.assign(document.createElement('div'), {innerHTML: logMsg}));
            
            document.getElementById('btnText').innerText = method === 'cashless' ? "Finalize Garage Dispatch" : "Confirm UPI Disbursement";
        }

        function verifyIdentity() {
            const btn = document.getElementById('verifyButton');
            btn.innerHTML = `Verifying Ledger Node...`;
            setTimeout(() => {
                btn.innerHTML = `‚úì Identity Verified: Authorized`;
                btn.classList.add('bg-green-500/20', 'text-green-400');
                document.getElementById('logs').prepend(Object.assign(document.createElement('div'), {className: 'text-green-400', innerHTML: `> Token validation successful.`}));
            }, 1200);
        }

        function processFinalPayout() {
            if (currentMethod === 'upi') {
                alert('Please select a payment method (Google Pay or Razorpay) to proceed.');
                return;
            }

            const btn = document.getElementById('finalizeBtn');
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('btnLoader');
            const logs = document.getElementById('logs');

            btnText.innerText = "Releasing Packet...";
            loader.classList.remove('hidden');
            btn.disabled = true;

            setTimeout(() => {
                logs.prepend(Object.assign(document.createElement('div'), {className: 'text-green-400 font-bold', innerHTML: `> Transaction Dispatched to Network.`}));
                setTimeout(() => {
                    window.location.href = 'receipt.html';
                }, 1500);
            }, 1000);
        }
    </script>
</body>
</html>