<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claim History | SmartClaim Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{ --bg:#07090f; --glass:rgba(255,255,255,.035); --border:rgba(255,255,255,.08); }
body{ font-family:'Plus Jakarta Sans',sans-serif; background: radial-gradient(circle at 15% 15%,rgba(56,189,248,.14),transparent 45%), radial-gradient(circle at 85% 85%,rgba(168,85,247,.12),transparent 45%), var(--bg); color:white; min-height:100vh; }
.glass{ background:var(--glass); backdrop-filter:blur(40px) saturate(160%); border:1px solid var(--border); }
.row{ position:relative; transition:all .4s cubic-bezier(.2,.8,.2,1); cursor:pointer; }
.row:hover{ transform:translateX(6px); background:linear-gradient(90deg,rgba(255,255,255,.06),transparent); }
.row::before{ content:''; position:absolute; left:0;top:0;height:100%;width:4px; border-radius:0 6px 6px 0; }
.green::before{background:#22c55e;box-shadow:0 0 18px #22c55e}
.red::before{background:#ef4444;box-shadow:0 0 18px #ef4444}
.yellow::before{background:#facc15;box-shadow:0 0 18px #facc15}
.badge{ padding:.35rem .9rem; border-radius:999px; font-size:10px; font-weight:900; letter-spacing:1px; }
.badge.green{background:#22c55e;color:#052e16}
.badge.red{background:#ef4444;color:#450a0a}
.badge.yellow{background:#facc15;color:#422006}
</style>
</head>
<body class="pb-24">
<nav class="sticky top-0 z-50 bg-black/40 backdrop-blur-xl border-b border-white/10">
  <div class="max-w-7xl mx-auto px-8 h-14 flex items-center justify-between">
    <div class="font-extrabold tracking-tight text-xl">SmartClaim<span class="text-sky-400">.Pro</span></div>
    <div class="hidden md:flex gap-8 text-sm font-semibold text-gray-300">
      <a href="index.html" class="hover:text-white">Home</a>
      <a href="submit-claim.html" class="hover:text-white">Claims</a>
      <a href="history.html" class="text-sky-400">History</a>
    </div>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-10 mt-14">
<div class="flex flex-wrap justify-between items-end gap-6 mb-12">
  <div>
    <h1 class="text-5xl font-black tracking-tight">Claim <span class="text-sky-400">History</span></h1>
    <p class="text-gray-400 mt-2 text-sm">A trust-ledger of every decision your profile has faced.</p>
  </div>
  <button onclick="localStorage.clear(); location.reload();" class="text-[10px] font-bold text-red-400 border border-red-400/30 px-4 py-2 rounded-lg hover:bg-red-400 transition uppercase tracking-widest hover:text-white">Clear All Data</button>
</div>

<div class="glass rounded-3xl p-6 mb-8 grid grid-cols-2 md:grid-cols-3 gap-6">
  <div><div class="text-gray-400 text-xs uppercase font-bold mb-1">Total Claims</div><div class="text-3xl font-black" id="total-claims">0</div></div>
  <div><div class="text-gray-400 text-xs uppercase font-bold mb-1">Approval Rate</div><div class="text-3xl font-black text-green-400" id="approval-rate">0%</div></div>
  <div><div class="text-gray-400 text-xs uppercase font-bold mb-1">Total Amount</div><div class="text-3xl font-black text-sky-400" id="total-amount">₹0</div></div>
</div>

<div class="glass rounded-[36px] overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-black/40 text-gray-400 uppercase text-xs">
<tr><th class="p-6 text-left">Claim</th><th>Date</th><th>Type</th><th>Amount</th><th>Status</th><th>Action</th></tr>
</thead>
<tbody id="history-body"></tbody>
</table>
</div>
</main>

<script>
window.onload = () => {
    const table = document.getElementById('history-body');
    let allClaims = JSON.parse(localStorage.getItem('allClaims')) || [];
    
    
    
    
    table.innerHTML = "";
    
    // Add all stored claims (most recent first - they're already sorted in allClaims array)
    allClaims.forEach((claim, i) => {
        // Get data from track-claim.html saved object
        let aiAmt = parseInt(claim.amount); // AI generated amount
        let userAmt = claim.userAmount || 0; // User's original amount
        let incidentDate = claim.date || "Jan 28, 2026";
        let incidentType = claim.type || "Road Accident";
        let status = claim.status || "green";
        
        // Determine display values based on status
        let statusText = "";
        let actionButton = "";
        let displayAmount = aiAmt; // Default to AI amount
        
        if (status === "red") {
            statusText = "Rejected";
            displayAmount = 0; // Red flags show ₹0
            actionButton = `<button onclick="window.location.href='submit-claim.html'" class="bg-red-500 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-red-600 transition">File Again</button>`;
        } else if (status === "yellow") {
            statusText = "Under Review";
            actionButton = `<button onclick="localStorage.setItem('claimedAmount', ${userAmt}); window.location.href='track-claim.html'" class="bg-yellow-500 text-black px-4 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-yellow-600 transition">Incomplete</button>`;
        } else {
            statusText = "Approved";
            actionButton = `<span class="text-green-500 text-2xl">✓</span>`;
        }

        table.innerHTML += `
        <tr class="row ${status} border-t border-white/5">
            <td class="p-6 font-mono text-sky-400">SC-${1000 + i}</td>
            <td>${incidentDate}</td>
            <td class="font-bold uppercase">${incidentType}</td>
            <td>₹${displayAmount.toLocaleString()}</td>
            <td><span class="badge ${status}">${statusText}</span></td>
            <td class="text-center">${actionButton}</td>
        </tr>`;
    });
    
    // Add default rows at the end (older claims)
    table.innerHTML += defaultRows;
    
    // Update stats
    const totalClaimsCount = allClaims.length + 2; // +2 for default rows
    document.getElementById('total-claims').innerText = totalClaimsCount;
    
    // Calculate approval rate (green claims / total claims * 100)
    const greenCount = allClaims.filter(c => c.status === 'green').length + 2; // +2 for default green rows
    const approvalRate = totalClaimsCount > 0 ? Math.round((greenCount / totalClaimsCount) * 100) : 0;
    document.getElementById('approval-rate').innerText = approvalRate + "%";
    
    // Calculate total AI amount from saved claims
    let totalAiAmt = allClaims.reduce((sum, c) => sum + parseInt(c.amount), 373222); // 373222 = sum of default amounts (358222 + 15000)
    
    document.getElementById('total-amount').innerText = "₹" + totalAiAmt.toLocaleString();
};
</script>
</body>
</html>